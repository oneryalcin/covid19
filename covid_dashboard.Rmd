---
title: "Covid-19"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
runtime: shiny
---


```{r}
library(tidyverse)
library(dplyr)
library(lubridate)
library(plotly)
library(shinydashboard)
library(flexdashboard)

df <- read_csv('https://coronavirus.data.gov.uk/downloads/csv/coronavirus-cases_latest.csv')

df <- df %>%  
  rename(cases=`Daily lab-confirmed cases`, day =`Specimen date`, area_name='Area name', area_type = `Area type`)
```


Positive Tests Daily
=======================================================================


Row {data-height=350}
-------------------------------------

### Total England Yesterday {data-width=40}


```{r}
england <- df %>% filter(area_type=='Nation') %>%
  group_by(day) %>% 
  summarise(total = sum(cases))

last_data = df[which.max(england$day),]

valueBox(last_data$total, caption = as.character(last_data$day), icon="fa-comments", color = "#05668d")

```



### England Total

```{r}
england = df %>% filter(area_type=='Nation') %>%
  group_by(day) %>% 
  summarise(total = sum(cases))

g <- england %>%  ggplot(aes(x=day, y=total)) +
                           geom_col(fill = '#02c39a') + 
                           theme_classic() +
                           xlab("") + ylab("cases")

ggplotly(g)

```


Row {data-height=750}
-------------------------------------
    
### Local authority daily cases

```{r}

local = df %>%  
  filter(area_type == "Lower tier local authority")


library(shiny)

ui <- fluidPage(
  titlePanel("Dashboard"),
  
  # Sidebar with a slider input for number of bins 
  sidebarLayout(
    sidebarPanel(width =3,
      selectInput(inputId = "area_name", label = ("Local authority"),
                  choices = unique(local$area_name), selected = 'Reading'
      )),
    
    
    mainPanel(width =7,
      plotlyOutput(outputId = "plot", height = "500px", width="500px")
    )
  )
)


# Define server logic required to draw a histogram
server <- function(input, output) {
  filtered_data<- reactive({
    dplyr::filter(local, local$area_name==input$area_name)
  })
  output$plot <- renderPlotly({
    #par(mar=c(1,1,1,1))

    
   g = local %>% 
      filter(area_name %in% input$area_name) %>% 
      ggplot(aes(x= filtered_data()$day, y= filtered_data()$cases)) + geom_bar(stat = "identity", fill = '#05668d') + xlab("") + ylab("cases") + theme_classic()

   ggplotly(g)
    
  })
}


shinyApp(ui = ui, server = server)
```



### England by Region


```{r}

regions = df %>% filter(area_type=='Region')


library(shiny)

ui <- fluidPage(
  titlePanel("Dashboard"),
  
  # Sidebar with a slider input for number of bins 
  sidebarLayout(
    sidebarPanel(width =3,
      selectInput(inputId = "area_name", label = ("Region"),
                  choices = unique(regions$area_name), selected = 'London'
      )),
    
    
    
    
    mainPanel(width = 7,
      plotlyOutput(outputId = "plot", height = "500px", width="500px")
    )
  )
)


# Define server logic required to draw a histogram
server <- function(input, output) {
  filtered_data<- reactive({
    dplyr::filter(regions, regions$area_name==input$area_name)
  })
  output$plot <- renderPlotly({
    #par(mar=c(1,1,1,1))

    
   g = regions %>% 
      filter(area_name %in% input$area_name) %>% 
      ggplot(aes(x= filtered_data()$day, y= filtered_data()$cases)) + geom_bar(stat = "identity", fill = '#f9c74f') + xlab("") + ylab("cases") + theme_classic()

   ggplotly(g)
    
  })
}


shinyApp(ui = ui, server = server)
```

